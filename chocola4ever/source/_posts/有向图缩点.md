title: 有向图缩点
author: Chocola4ever
tags:
  - 模板
  - 缩点
categories:
  - 算法
date: 2021-03-29 17:51:00
---
```cpp
#include<bits/stdc++.h>
#define N 100005
using namespace std;
struct{
	int nxt,to;
}e[N*5];
stack<int> st;
stack<int> st1;
int head[N*5],dfn[N],low[N],id[N],u1[N*5],v1[N*5],sz[N];
bool inst[N];
int newcnt,cnt,totedge,n,m;
inline void addedge(int x,int y){
	e[++totedge].to=y;
	e[totedge].nxt=head[x];
	head[x]=totedge;
}
inline void tarjan(int u){
	dfn[u]=++cnt;
	low[u]=cnt;
	inst[u]=1;
	st1.push(u);
	for (int i=head[u];i;i=e[i].nxt){
		int v=e[i].to;
		if (!dfn[v]){
			tarjan(v);
			low[u]=min(low[u],low[v]);
		} else if (inst[v])
			low[u]=min(low[u],dfn[v]);
	}
	int v;
	if (dfn[u]==low[u]){
		newcnt++;
		do{
			v=st1.top();
			st1.pop();
			inst[v]=0;
			id[v]=newcnt;
			sz[newcnt]++;
		} while (v!=u);
	}
}
int main(){
	scanf("%d%d",&n,&m);
	for (int i=1;i<=m;++i){
		scanf("%d%d",&u1[i],&v1[i]);
		addedge(u1[i],v1[i]);
	}
	for (int i=1;i<=n;i++)
		if (!dfn[i])
			tarjan(i);
	memset(e,0,sizeof(e));
	memset(head,0,sizeof(head));
	totedge=0;
	for (int i=1;i<=m;i++)
		if (id[u1[i]]!=id[v1[i]])
			addedge(id[u1[i]],id[v1[i]]);
	// 
	return 0;
}
```
