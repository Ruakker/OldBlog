title: 无向图缩点
author: Chocola4ever
tags:
  - 缩点
  - 算法
categories:
  - 算法
date: 2021-03-29 17:53:00
---
```cpp
#include<bits/stdc++.h>
#define N 300005
#define inf 0x3f3f3f3f
using namespace std;
struct{
	int nxt,to;
}e[N*2];
stack<int> st;
stack<int> st1;
int head[N*2],dfn[N],low[N],id[N],u1[N],v1[N],sz[N];
bool inst[N],vis[N];
int newcnt,cnt,totedge,n,m,dist,maxdist,maxn;
inline void addedge(int x,int y){
	e[++totedge].to=y;
	e[totedge].nxt=head[x];
	head[x]=totedge;
}
inline void tarjan(int u,int pre){
	dfn[u]=++cnt;
	low[u]=cnt;
	inst[u]=1;
	st1.push(u);
	for (int i=head[u];i;i=e[i].nxt){
		int v=e[i].to;
		if (v==pre) continue;
		if (!dfn[v]){
			tarjan(v,u);
			low[u]=min(low[u],low[v]);
		} else if (inst[v])
			low[u]=min(low[u],dfn[v]);
	}
	int v;
	if (dfn[u]==low[u]){
		newcnt++;
		do{
			v=st1.top();
			st1.pop();
			inst[v]=0;
			id[v]=newcnt;
			sz[newcnt]++;
		} while (v!=u);
	}
}
inline void dfs(int u){
	vis[u]=1;
	if (dist>maxdist)
		maxdist=dist,maxn=u;
	for (int i=head[u];i;i=e[i].nxt){
		int v=e[i].to;
		if (!vis[v]){
			dist++;
			dfs(v);
			dist--;
		}
	}
}
int main(){
//	...
	for (int i=1;i<=n;i++)
		if (!dfn[i])
			tarjan(i,-1);
	memset(e,0,sizeof(e));
	memset(head,0,sizeof(head));
	totedge=0;
	for (int i=1;i<=m;i++)
		if (id[u1[i]]!=id[v1[i]]){
			addedge(id[u1[i]],id[v1[i]]);
			addedge(id[v1[i]],id[u1[i]]);
		}
//	...
}
```